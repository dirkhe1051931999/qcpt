.j-q-select {
  .q-field__native > span {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .float-placeholder {
    font-size: 14px;
    color: var(--j-color-grey);
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    left: 0;
  }

  // 让下拉框文字垂直居中
  .q-field__native {
    display: flex;
    align-items: center;

    > span {
      line-height: normal;
    }
  }
}

.j-q-select-popup {
  max-height: 20rem !important;
}

.j-q-select.q-select--multiple {
  .q-field__control {
    height: auto !important;
    min-height: 36px !important;

    &:before {
      border: 1px solid rgba(0, 0, 0, 0.08);
    }
  }

  .q-field__control-container {
    display: flex;
    flex-wrap: nowrap;

    .q-field__native {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;

      .select-selected-item {
        padding: 2px 4px;
        border-radius: 2px;
        background-color: var(--j-color-grey-light);
        display: flex;
        align-items: center;
      }
    }
  }
}

// ------------------------------------------------------------------
// 核心混入：QField 控件基础重置 (与最终代码保持一致)
// ------------------------------------------------------------------

@mixin field-control-reset($height, $base-padding-top, $native-min-height, $control-container-padding-top) {
  &.q-field--dense {
    // 1. 统一 QField 控件和边距的高度
    .q-field__control,
    .q-field__marginal {
      height: $height !important;
      min-height: $height !important;

      .q-field__control-container {
        padding-top: $control-container-padding-top !important;
      }
    }

    // 2. 强制重置 QField 内容容器的垂直 padding
    .q-field__native {
      // 关键修正：设置基础的 padding-top
      padding-top: $base-padding-top !important;
      padding-bottom: 0 !important;
      min-height: $native-min-height !important;

      .q-field__control-input {
        padding-top: 0 !important;
        padding-bottom: 0 !important;
      }
    }

    // 4. 重置 QField 默认的 line-height
    // 无标签时，control 的 line-height 决定了文本的垂直居中
    .q-field__control {
      line-height: $height;

      &:before {
        border: 1px solid rgba(0, 0, 0, 0.08);
      }
    }
  }
}

// ------------------------------------------------------------------
// 修正 j-q-select--table 模式 (高度 36px)
// ------------------------------------------------------------------
.j-q-select--table {
  // 与 table 模式的 QInput 保持一致：高度 36px, padding-top 14px
  @include field-control-reset(36px, 0, 20px, 12px);

  &.q-field--dense {
    // 标签位置调整
    .q-field__label {
      top: 8px !important;
    }

    &.q-field--float .q-field__label {
      transform: translateY(-30%) scale(0.65) !important;
      top: 10px !important;
    }

    // 标签浮动 (labeled) 状态修正
    &.q-field--labeled {
      .q-field__control {
        // 关键修正：内容区域高度是 36px - 14px = 22px
        line-height: 22px;
      }

      .q-field__control-input {
        padding-top: 0 !important;
      }
    }

    .q-field__native {
      span:not(.select-selected-item) {
        max-width: 150px !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        white-space: nowrap !important;
      }

      .q-field__input {
        max-width: 50px !important;
      }
    }
  }

  &.proxy-select {
    &.q-field--dense {
      .q-field__native {
        span:not(.select-selected-item) {
          max-width: 120px !important;
        }

        .q-field__input {
          max-width: 20px !important;
        }
      }
    }
  }
}

// ------------------------------------------------------------------
// 修正 j-q-select--form 模式 (高度 40px)
// ------------------------------------------------------------------
.j-q-select--form {
  &:not(.q-select--multiple) {
    @include field-control-reset(40px, 0, 40px, 0px);
  }

  &.q-select--without-chips {
    @include field-control-reset(40px, 0, 40px, 0px);
  }

  &.q-field--dense {
    // 标签浮动 (labeled) 状态修正
    &.q-field--labeled {
      .q-field__control {
        // 关键修正：line-height 24px (依赖 Quasar 自动推开 16px 空间)
        line-height: 24px;
      }

      .q-field__control-input {
        padding-top: 0 !important;
      }
    }

    .q-field__native {
      span:not(.select-selected-item) {
        max-width: 80% !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        white-space: nowrap !important;
      }

      .q-field__input {
        max-width: 50% !important;
      }
    }
  }
}

// ------------------------------------------------------------------
// 修正 j-q-select--sm 模式 (高度 36px)
// 和 --form 模式一样，只是高度改为 36px
// ------------------------------------------------------------------
.j-q-select--sm {
  &:not(.q-select--multiple) {
    @include field-control-reset(36px, 0, 36px, 0px);
  }

  &.q-field--dense {
    // 标签浮动 (labeled) 状态修正
    &.q-field--labeled {
      .q-field__control {
        // 关键修正：内容区域高度是 36px - 14px = 22px
        line-height: 22px;
      }

      .q-field__control-input {
        padding-top: 0 !important;
      }
    }

    .q-field__native {
      span:not(.select-selected-item) {
        max-width: 80% !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        white-space: nowrap !important;
      }

      .q-field__input {
        max-width: 50% !important;
      }
    }
  }
}