/* 一个自动生成 svg 的工具函数 */
import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';
import { dirname } from 'path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// 要读取的目录路径
const iconsDir = path.join(__dirname, '../src', 'assets');

// 递归读取指定目录下的所有 SVG 文件，并根据配置决定是否转换为 Base64 编码
function readSVGFilesToBase64(dir, prefix = '') {
  const files = fs.readdirSync(dir);
  const result = {};

  files.forEach((file) => {
    const filePath = path.join(dir, file);
    const stat = fs.statSync(filePath);

    if (stat.isDirectory()) {
      // 如果是目录，则递归读取
      const subdir = path.join(dir, file);
      const subPrefix = prefix ? `${prefix}:${file}` : file;
      Object.assign(result, readSVGFilesToBase64(subdir, subPrefix));
    } else if (path.extname(file).toLowerCase() === '.svg') {
      const baseName = path.basename(file, '.svg');
      const iconName = prefix ? `app:${baseName}` : baseName;

      let value;
      const svgContent = fs.readFileSync(filePath, 'utf8');
      value = `data:image/svg+xml;base64,${Buffer.from(svgContent).toString('base64')}`;

      result[iconName] = value;
    }
  });

  return result;
}

const newData = readSVGFilesToBase64(iconsDir);

// 生成 TypeScript 模块的内容
const comment = `/* eslint-disable */\n// This file is auto-generated by generate-custom-svg.js\n`;
const moduleContent = `export const myIcons: { [key: string]: string } = ${JSON.stringify(newData, null, 2).replace(/"/g, "'")};\n`;
const content = comment + moduleContent;

// 将内容写入文件
const outputFilePath = path.join(__dirname, '../src', 'utils', 'custom-svg.ts');
fs.writeFileSync(outputFilePath, content);

console.log(`Icons module has been generated at: ${outputFilePath}`);
